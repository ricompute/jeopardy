<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeopardy!</title>
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImJnIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiMxYTFhZmYiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMDAwMGFhIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJnb2xkIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNGRkREMzMiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojQ0M5OTAwIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8IS0tIEJhY2tncm91bmQgLS0+CiAgPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0idXJsKCNiZykiLz4KICA8IS0tIEJvcmRlciAtLT4KICA8cmVjdCB4PSIxIiB5PSIxIiB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHJ4PSIzIiBmaWxsPSJub25lIiBzdHJva2U9IiNGRkNDMDAiIHN0cm9rZS13aWR0aD0iMS41Ii8+CiAgPCEtLSBKIGxldHRlciAtLT4KICA8dGV4dCB4PSI4IiB5PSIyNCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjIyIiBmb250LXdlaWdodD0iYm9sZCIgZm9udC1zdHlsZT0iaXRhbGljIiBmaWxsPSJ1cmwoI2dvbGQpIj5KPC90ZXh0PgogIDwhLS0gRXhjbGFtYXRpb24gbWFyayAtLT4KICA8dGV4dCB4PSIyMCIgeT0iMjQiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IiNGRkNDMDAiPiE8L3RleHQ+Cjwvc3ZnPgo=">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Helvetica Neue', sans-serif;
            background-color: #060CE9;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Upload Screen */
        #upload-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 30px;
            width: 100%;
            height: 100%;
        }

        #upload-screen h1 {
            color: #FFCC00;
            font-size: 4rem;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            font-style: italic;
            letter-spacing: 2px;
        }

        .upload-container {
            background: linear-gradient(180deg, #1a1aff 0%, #0000aa 100%);
            border: 4px solid #FFCC00;
            border-radius: 10px;
            padding: 40px 60px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .upload-container.drag-over {
            border-color: #fff;
            background: linear-gradient(180deg, #2a2aff 0%, #1111cc 100%);
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(255, 204, 0, 0.5);
        }

        .upload-container p {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .upload-container .drag-text {
            color: rgba(255,255,255,0.7);
            font-size: 1rem;
            margin-top: 15px;
        }

        .upload-container .format-hint {
            color: rgba(255,255,255,0.6);
            font-size: 0.85rem;
            margin-top: 20px;
            line-height: 1.5;
        }

        #csv-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(180deg, #FFDD33 0%, #CC9900 100%);
            color: #060CE9;
            border: none;
            padding: 15px 40px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            text-transform: uppercase;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .upload-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 204, 0, 0.5);
        }

        .download-links {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .download-link {
            color: #FFCC00;
            font-size: 1rem;
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.2s;
        }

        .download-link:hover {
            color: #fff;
        }

        /* Settings Section */
        .settings-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,204,0,0.3);
        }

        .settings-row {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .settings-row label {
            color: white;
            font-size: 1rem;
        }

        .settings-row input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .settings-row select, .settings-row input[type="number"] {
            padding: 8px 12px;
            font-size: 1rem;
            border: 2px solid #FFCC00;
            border-radius: 5px;
            background: #0000aa;
            color: white;
            cursor: pointer;
        }

        .settings-row input[type="number"] {
            width: 80px;
        }

        .settings-row select:focus, .settings-row input[type="number"]:focus {
            outline: none;
            border-color: #fff;
        }

        /* Point Values Config */
        .point-values-config {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .point-values-config .config-label {
            color: #FFCC00;
            font-size: 0.95rem;
            font-weight: bold;
        }

        .point-values-row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .point-value-input {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .point-value-input label {
            color: rgba(255,255,255,0.8);
            font-size: 0.85rem;
        }

        .point-value-input input {
            width: 70px;
            padding: 6px 8px;
            font-size: 0.95rem;
            border: 2px solid #FFCC00;
            border-radius: 5px;
            background: #0000aa;
            color: #FFCC00;
            text-align: center;
        }

        .point-value-input input:focus {
            outline: none;
            border-color: #fff;
        }

        /* Warning Modal */
        #warning-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        #warning-modal.active {
            display: flex;
        }

        .warning-content {
            background: linear-gradient(180deg, #1a1aff 0%, #0000aa 100%);
            border: 4px solid #FF6600;
            border-radius: 10px;
            padding: 30px 40px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
        }

        .warning-content h2 {
            color: #FF6600;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .warning-list {
            text-align: left;
            color: white;
            font-size: 1rem;
            margin-bottom: 25px;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }

        .warning-list ul {
            list-style-type: none;
            padding: 0;
        }

        .warning-list li {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
        }

        .warning-list li::before {
            content: "⚠";
            position: absolute;
            left: 0;
            color: #FF6600;
        }

        .warning-list li.error::before {
            content: "✗";
            color: #FF0000;
        }

        .warning-list li.info::before {
            content: "ℹ";
            color: #00CCFF;
        }

        .warning-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .warning-btn {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            border: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .warning-btn:hover {
            transform: scale(1.05);
        }

        .warning-btn.proceed {
            background: linear-gradient(180deg, #FFDD33 0%, #CC9900 100%);
            color: #060CE9;
        }

        .warning-btn.cancel {
            background: linear-gradient(180deg, #666 0%, #444 100%);
            color: white;
        }

        /* Game Board - 16:9 optimized */
        #game-board {
            display: none;
            width: 100%;
            height: 100%;
            max-width: calc(100vh * 16 / 9);
            max-height: calc(100vw * 9 / 16);
            aspect-ratio: 16 / 9;
        }

        .board-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: 1.2fr repeat(4, 1fr);
            gap: 6px;
            width: 100%;
            height: 100%;
        }

        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            padding: 10px;
        }

        .category-cell {
            background: linear-gradient(180deg, #1a1aff 0%, #0000aa 100%);
            border: 3px solid #000;
            color: #FFFFFF;
            font-size: clamp(0.7rem, 1.8vw, 1.4rem);
            font-weight: bold;
            text-transform: uppercase;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            cursor: default;
            line-height: 1.2;
        }

        .value-cell {
            background: linear-gradient(180deg, #1a1aff 0%, #0000aa 100%);
            border: 3px solid #000;
            color: #FFCC00;
            font-size: clamp(1.5rem, 4vw, 3.5rem);
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
        }

        .value-cell:hover:not(.used) {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.5);
        }

        .value-cell.used {
            opacity: 0.25;
            cursor: default;
            background: linear-gradient(180deg, #0a0a66 0%, #000055 100%);
        }

        /* Prompt/Answer Screen */
        #prompt-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #060CE9;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 40px;
        }

        #prompt-screen.active {
            display: flex;
        }

        #prompt-text {
            color: #FFFFFF;
            font-size: clamp(2rem, 6vw, 4.5rem);
            text-transform: uppercase;
            text-align: center;
            font-weight: bold;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            max-width: 90%;
            line-height: 1.3;
        }

        #prompt-value {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: #FFCC00;
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* Timer Display */
        #timer-display {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            color: #FFCC00;
            font-size: 4rem;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            font-variant-numeric: tabular-nums;
        }

        #timer-display.warning {
            color: #FF6600;
            animation: pulse 0.5s ease-in-out infinite;
        }

        #timer-display.critical {
            color: #FF0000;
            animation: pulse 0.25s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }

        /* Daily Double Screen */
        #daily-double-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #060CE9;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 40px;
        }

        #daily-double-screen.active {
            display: flex;
        }

        #daily-double-text {
            color: #FFCC00;
            font-size: clamp(4rem, 10vw, 8rem);
            font-style: italic;
            text-transform: uppercase;
            text-align: center;
            font-weight: bold;
            text-shadow: 6px 6px 12px rgba(0,0,0,0.7);
            animation: dailyDoublePulse 0.8s ease-in-out infinite;
        }

        @keyframes dailyDoublePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Round Transition Screen */
        #round-transition-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #060CE9;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 40px;
        }

        #round-transition-screen.active {
            display: flex;
        }

        #round-transition-text {
            color: #FFCC00;
            font-size: clamp(4rem, 10vw, 7rem);
            font-style: italic;
            text-transform: uppercase;
            text-align: center;
            font-weight: bold;
            text-shadow: 6px 6px 12px rgba(0,0,0,0.7);
            animation: roundPulse 1.5s ease-in-out infinite;
        }

        #round-transition-subtitle {
            color: white;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            margin-top: 30px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        }

        @keyframes roundPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.03); opacity: 0.9; }
        }

        /* Final Jeopardy */
        #final-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #060CE9;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 40px;
        }

        #final-screen.active {
            display: flex;
        }

        #final-title {
            color: #FFCC00;
            font-size: clamp(3rem, 8vw, 6rem);
            font-style: italic;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            letter-spacing: 4px;
        }

        #final-category {
            color: #FFFFFF;
            font-size: clamp(2rem, 5vw, 3.5rem);
            text-transform: uppercase;
            text-align: center;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-top: 40px;
        }

        #final-text {
            color: #FFFFFF;
            font-size: clamp(2rem, 5vw, 4rem);
            text-transform: uppercase;
            text-align: center;
            font-weight: bold;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            max-width: 90%;
            line-height: 1.3;
        }

        #final-timer-display {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            color: #FFCC00;
            font-size: 4rem;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            font-variant-numeric: tabular-nums;
        }

        #final-timer-display.warning {
            color: #FF6600;
            animation: pulse 0.5s ease-in-out infinite;
        }

        #final-timer-display.critical {
            color: #FF0000;
            animation: pulse 0.25s ease-in-out infinite;
        }

        /* Game Over */
        #game-over {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #060CE9;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 30px;
            padding: 40px;
        }

        #game-over.active {
            display: flex;
        }

        #game-over h1 {
            color: #FFCC00;
            font-size: clamp(3rem, 8vw, 5rem);
            font-style: italic;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
        }

        .play-again-btn {
            background: linear-gradient(180deg, #FFDD33 0%, #CC9900 100%);
            color: #060CE9;
            border: none;
            padding: 20px 50px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            text-transform: uppercase;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .play-again-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 204, 0, 0.5);
        }

        /* Reset button */
        #reset-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255,204,0,0.2);
            color: #FFCC00;
            border: 2px solid #FFCC00;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            border-radius: 5px;
            transition: background 0.2s;
            z-index: 1000;
        }

        #reset-btn:hover {
            background: rgba(255,204,0,0.4);
        }

        /* Game mode indicator */
        #mode-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            color: #FFCC00;
            font-size: 1.1rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .hidden {
            display: none !important;
        }

        /* Fullscreen optimization */
        @media (min-aspect-ratio: 16/9) {
            #game-board {
                height: 90vh;
                width: calc(90vh * 16 / 9);
            }
        }

        @media (max-aspect-ratio: 16/9) {
            #game-board {
                width: 95vw;
                height: calc(95vw * 9 / 16);
            }
        }
    </style>
</head>
<body>
    <!-- Upload Screen -->
    <div id="upload-screen">
        <h1>JEOPARDY!</h1>
        <div class="upload-container" id="drop-zone">
            <p>Upload your Jeopardy game CSV file to begin</p>
            <input type="file" id="csv-input" accept=".csv">
            <button class="upload-btn" onclick="document.getElementById('csv-input').click()">
                Choose CSV File
            </button>
            <p class="drag-text">or drag and drop a CSV file here</p>
            
            <div class="settings-section">
                <!-- Point Values Configuration -->
                <div class="point-values-config">
                    <span class="config-label">Point Values (Row 1–4)</span>
                    <div class="point-values-row">
                        <div class="point-value-input">
                            <label>1:</label>
                            <input type="number" id="point-value-1" value="200" min="0" step="100">
                        </div>
                        <div class="point-value-input">
                            <label>2:</label>
                            <input type="number" id="point-value-2" value="400" min="0" step="100">
                        </div>
                        <div class="point-value-input">
                            <label>3:</label>
                            <input type="number" id="point-value-3" value="600" min="0" step="100">
                        </div>
                        <div class="point-value-input">
                            <label>4:</label>
                            <input type="number" id="point-value-4" value="800" min="0" step="100">
                        </div>
                    </div>
                </div>

                <!-- Timer Settings -->
                <div class="settings-row">
                    <input type="checkbox" id="timer-enabled" checked>
                    <label for="timer-enabled">Enable Timer</label>
                    <select id="timer-preset">
                        <option value="30">30 seconds</option>
                        <option value="60" selected>60 seconds</option>
                        <option value="90">90 seconds</option>
                        <option value="custom">Custom</option>
                    </select>
                    <input type="number" id="timer-custom" min="5" max="300" value="60" class="hidden" placeholder="sec">
                </div>
            </div>
            
            <p class="format-hint">
                Format: Round, Category, Order, Prompt, Answer<br>
                (For single round, just use Round 1)
            </p>
        </div>
        <div class="download-links">
            <a class="download-link" id="download-template">Download CSV Template</a>
        </div>
    </div>

    <!-- Warning Modal -->
    <div id="warning-modal">
        <div class="warning-content">
            <h2>⚠ CSV Validation Issues</h2>
            <div class="warning-list" id="warning-list">
                <ul id="warning-items"></ul>
            </div>
            <div class="warning-buttons">
                <button class="warning-btn cancel" onclick="closeWarningModal()">Cancel</button>
                <button class="warning-btn proceed" id="proceed-btn">Continue Anyway</button>
            </div>
        </div>
    </div>

    <!-- Game Board -->
    <div id="game-board">
        <div class="board-grid" id="board-grid"></div>
    </div>

    <!-- Daily Double Screen -->
    <div id="daily-double-screen">
        <div id="daily-double-text">DAILY<br>DOUBLE!</div>
    </div>

    <!-- Round Transition Screen -->
    <div id="round-transition-screen">
        <div id="round-transition-text">DOUBLE<br>JEOPARDY!</div>
        <div id="round-transition-subtitle">Click to continue</div>
    </div>

    <!-- Prompt/Answer Screen -->
    <div id="prompt-screen">
        <div id="prompt-value"></div>
        <div id="prompt-text"></div>
        <div id="timer-display"></div>
    </div>

    <!-- Final Jeopardy Screens -->
    <div id="final-screen">
        <div id="final-title">FINAL JEOPARDY!</div>
        <div id="final-category"></div>
        <div id="final-text"></div>
        <div id="final-timer-display"></div>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over">
        <h1>GAME OVER!</h1>
        <button class="play-again-btn" onclick="resetGame()">Play Again</button>
    </div>

    <!-- Mode Indicator -->
    <div id="mode-indicator" class="hidden"></div>

    <!-- Reset Button -->
    <button id="reset-btn" class="hidden" onclick="resetGame()">New Game</button>

    <script>
        // CSV Template
        const csvTemplate = `Round,Category,Order,Prompt,Answer
1,Science,1,This molecule has the chemical formula H2O,What is water?
1,Science,2,The closest star to Earth,What is the Sun?
1,Science,3,This force keeps planets in orbit around the Sun,What is gravity?
1,Science,4,The number of bones in an adult human body,What is 206?
1,History,1,The year the Declaration of Independence was signed,What is 1776?
1,History,2,This ancient civilization built the pyramids at Giza,What is Egypt?
1,History,3,The ship that brought the Pilgrims to America in 1620,What is the Mayflower?
1,History,4,This wall divided Berlin from 1961 to 1989,What is the Berlin Wall?
1,Geography,1,The largest ocean on Earth,What is the Pacific Ocean?
1,Geography,2,This river is the longest in Africa,What is the Nile?
1,Geography,3,The smallest country in the world by area,What is Vatican City?
1,Geography,4,This mountain range separates Europe from Asia,What are the Urals?
1,Pop Culture,1,The boy wizard created by J.K. Rowling,Who is Harry Potter?
1,Pop Culture,2,This 1994 film follows Forrest through decades of American history,What is Forrest Gump?
1,Pop Culture,3,The fictional country where Black Panther is set,What is Wakanda?
1,Pop Culture,4,This band released the album "Abbey Road" in 1969,Who are The Beatles?
1,Literature,1,The author of "Romeo and Juliet",Who is William Shakespeare?
1,Literature,2,This novel begins "Call me Ishmael",What is Moby-Dick?
1,Literature,3,The dystopian novel featuring Big Brother,What is 1984?
1,Literature,4,This Greek epic tells of Odysseus's journey home,What is The Odyssey?
2,Technology,1,This company created the iPhone,What is Apple?
2,Technology,2,The programming language created by Guido van Rossum,What is Python?
2,Technology,3,This protocol powers the World Wide Web,What is HTTP?
2,Technology,4,The year the first email was sent,What is 1971?
2,Sports,1,The number of players on a basketball team on the court,What is 5?
2,Sports,2,This country has won the most FIFA World Cups,What is Brazil?
2,Sports,3,The length in miles of a marathon,What is 26.2?
2,Sports,4,This boxer was known as "The Greatest",Who is Muhammad Ali?
2,Music,1,The number of strings on a standard guitar,What is 6?
2,Music,2,This Austrian composer wrote "The Magic Flute",Who is Mozart?
2,Music,3,The decade that saw the birth of hip-hop,What are the 1970s?
2,Music,4,This instrument has 88 keys,What is a piano?
2,Movies,1,The director of "Jurassic Park" and "E.T.",Who is Steven Spielberg?
2,Movies,2,This 1997 film won 11 Academy Awards,What is Titanic?
2,Movies,3,The actor who played the Joker in "The Dark Knight",Who is Heath Ledger?
2,Movies,4,This studio created "Toy Story",What is Pixar?
2,Food & Drink,1,The country of origin for sushi,What is Japan?
2,Food & Drink,2,This spice comes from the crocus flower,What is saffron?
2,Food & Drink,3,The main ingredient in traditional hummus,What are chickpeas?
2,Food & Drink,4,This French term means "everything in place" for cooking prep,What is mise en place?
Final,Ancient Wonders,Final,This ancient wonder of the world was located in Alexandria,What is the Lighthouse (or Pharos)?`;

        // Game state
        let gameData = {
            rounds: {
                1: { categories: [], dailyDoubleCells: [], usedCells: new Set(), totalCells: 0 },
                2: { categories: [], dailyDoubleCells: [], usedCells: new Set(), totalCells: 0 }
            },
            finalJeopardy: { category: '', prompt: '', answer: '' },
            currentRound: 1,
            hasTwoRounds: false
        };

        let currentView = 'upload';
        let currentCell = null;
        let timerInterval = null;
        let timerSeconds = 0;

        // Settings
        let timerEnabled = true;
        let timerDuration = 60;
        let pointValues = [200, 400, 600, 800]; // Configurable point values for rows 1-4

        // DOM Elements
        const uploadScreen = document.getElementById('upload-screen');
        const gameBoard = document.getElementById('game-board');
        const boardGrid = document.getElementById('board-grid');
        const dailyDoubleScreen = document.getElementById('daily-double-screen');
        const roundTransitionScreen = document.getElementById('round-transition-screen');
        const promptScreen = document.getElementById('prompt-screen');
        const promptValue = document.getElementById('prompt-value');
        const promptText = document.getElementById('prompt-text');
        const timerDisplay = document.getElementById('timer-display');
        const finalScreen = document.getElementById('final-screen');
        const finalTitle = document.getElementById('final-title');
        const finalCategory = document.getElementById('final-category');
        const finalText = document.getElementById('final-text');
        const finalTimerDisplay = document.getElementById('final-timer-display');
        const gameOver = document.getElementById('game-over');
        const resetBtn = document.getElementById('reset-btn');
        const csvInput = document.getElementById('csv-input');
        const dropZone = document.getElementById('drop-zone');
        const downloadLink = document.getElementById('download-template');
        const timerEnabledCheckbox = document.getElementById('timer-enabled');
        const timerPreset = document.getElementById('timer-preset');
        const timerCustom = document.getElementById('timer-custom');
        const warningModal = document.getElementById('warning-modal');
        const warningItems = document.getElementById('warning-items');
        const proceedBtn = document.getElementById('proceed-btn');
        const modeIndicator = document.getElementById('mode-indicator');

        // Point value inputs
        const pointValueInputs = [
            document.getElementById('point-value-1'),
            document.getElementById('point-value-2'),
            document.getElementById('point-value-3'),
            document.getElementById('point-value-4')
        ];

        // Download template
        downloadLink.addEventListener('click', () => {
            const blob = new Blob([csvTemplate], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'jeopardy_template.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Timer settings handlers
        timerPreset.addEventListener('change', () => {
            if (timerPreset.value === 'custom') {
                timerCustom.classList.remove('hidden');
            } else {
                timerCustom.classList.add('hidden');
                timerDuration = parseInt(timerPreset.value);
            }
        });

        timerCustom.addEventListener('change', () => {
            timerDuration = parseInt(timerCustom.value) || 60;
        });

        timerEnabledCheckbox.addEventListener('change', () => {
            timerEnabled = timerEnabledCheckbox.checked;
        });

        // Drag and drop handlers
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropZone.classList.add('drag-over');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropZone.classList.remove('drag-over');
            }, false);
        });

        dropZone.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].name.endsWith('.csv')) {
                handleFile(files[0]);
            }
        }, false);

        // CSV Line Parser (handles quoted fields)
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        // Detect CSV format (single round vs two rounds)
        function detectCSVFormat(lines) {
            if (lines.length === 0) return 'unknown';
            
            const header = parseCSVLine(lines[0]);
            const firstCol = header[0]?.toLowerCase().trim();
            
            // Check if first column is "Round"
            if (firstCol === 'round') {
                return 'two-round';
            }
            
            // Check if first column is "Category"
            if (firstCol === 'category') {
                return 'single-round';
            }
            
            // Try to detect from data - check if first column of data rows are numbers
            if (lines.length > 1) {
                const firstDataRow = parseCSVLine(lines[1]);
                const firstValue = firstDataRow[0]?.trim();
                if (firstValue === '1' || firstValue === '2' || firstValue.toLowerCase() === 'final') {
                    return 'two-round';
                }
            }
            
            return 'single-round'; // Default to single round
        }

        // Normalize order value - accepts 1-4 or legacy dollar values (200, 400, 600, 800)
        function normalizeOrder(value) {
            const num = parseInt(value);
            if (isNaN(num)) return null;
            
            // If it's 1-4, use directly
            if (num >= 1 && num <= 4) return num;
            
            // Legacy support: convert dollar values to order
            const legacyMap = { 200: 1, 400: 2, 600: 3, 800: 4 };
            return legacyMap[num] || null;
        }

        // CSV Validation
        function validateCSV(text) {
            const warnings = [];
            const errors = [];
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            
            if (lines.length === 0) {
                errors.push({ type: 'error', message: 'CSV file is empty' });
                return { warnings, errors, isValid: false };
            }

            const format = detectCSVFormat(lines);
            const isTwoRound = format === 'two-round';
            
            // Track categories and their orders per round
            const roundData = { 1: new Map(), 2: new Map() };
            const standardOrders = [1, 2, 3, 4];
            const invalidOrders = [];
            let hasFinalJeopardy = false;
            let rowsWithMissingData = [];

            for (let i = 1; i < lines.length; i++) {
                const parts = parseCSVLine(lines[i]);
                const rowNum = i + 1;

                let round, category, order, prompt, answer;
                
                if (isTwoRound) {
                    if (parts.length < 5) {
                        rowsWithMissingData.push(rowNum);
                        continue;
                    }
                    [round, category, order, prompt, answer] = parts;
                    
                    // Normalize round
                    const roundLower = round.toLowerCase().trim();
                    if (roundLower === 'final') {
                        round = 'final';
                    } else {
                        round = parseInt(round) || 1;
                    }
                } else {
                    if (parts.length < 4) {
                        rowsWithMissingData.push(rowNum);
                        continue;
                    }
                    [category, order, prompt, answer] = parts;
                    round = 1;
                }

                // Check for empty fields
                if (!category || !prompt) {
                    rowsWithMissingData.push(rowNum);
                    continue;
                }

                if (!answer) {
                    warnings.push({ type: 'warning', message: `Row ${rowNum}: Missing answer for "${prompt.substring(0, 30)}..."` });
                }

                // Check for Final Jeopardy
                if (order.toLowerCase() === 'final' || round === 'final') {
                    hasFinalJeopardy = true;
                    continue;
                }

                // Validate and normalize order
                const normalizedOrder = normalizeOrder(order);
                
                if (normalizedOrder === null) {
                    warnings.push({ type: 'warning', message: `Row ${rowNum}: Invalid order "${order}" (expected 1-4)` });
                    continue;
                }

                if (!standardOrders.includes(normalizedOrder)) {
                    invalidOrders.push({ row: rowNum, order: normalizedOrder });
                }

                // Track category orders per round
                const roundNum = (round === 'final') ? 1 : (round || 1);
                if (!roundData[roundNum]) roundData[roundNum] = new Map();
                
                if (!roundData[roundNum].has(category)) {
                    roundData[roundNum].set(category, new Set());
                }
                roundData[roundNum].get(category).add(normalizedOrder);
            }

            // Report invalid orders
            if (invalidOrders.length > 0) {
                const summary = invalidOrders.slice(0, 5).map(v => `Row ${v.row}: ${v.order}`).join(', ');
                const more = invalidOrders.length > 5 ? ` (and ${invalidOrders.length - 5} more)` : '';
                warnings.push({ type: 'warning', message: `Non-standard order values: ${summary}${more}. Expected: 1, 2, 3, 4` });
            }

            // Report rows with missing data
            if (rowsWithMissingData.length > 0) {
                const summary = rowsWithMissingData.slice(0, 5).join(', ');
                const more = rowsWithMissingData.length > 5 ? ` (and ${rowsWithMissingData.length - 5} more)` : '';
                warnings.push({ type: 'warning', message: `Rows with missing/incomplete data: ${summary}${more}` });
            }

            // Check each round
            const hasRound2 = roundData[2] && roundData[2].size > 0;
            
            for (const [roundNum, categoryMap] of Object.entries(roundData)) {
                if (categoryMap.size === 0) continue;
                
                const roundLabel = hasRound2 ? `Round ${roundNum}` : '';
                
                // Check for incomplete categories
                for (const [category, orders] of categoryMap) {
                    const missingOrders = standardOrders.filter(o => !orders.has(o));
                    if (missingOrders.length > 0) {
                        warnings.push({ type: 'warning', message: `${roundLabel} "${category}" missing order: ${missingOrders.join(', ')}` });
                    }
                }

                // Check number of categories
                if (categoryMap.size < 5) {
                    warnings.push({ type: 'warning', message: `${roundLabel} has ${categoryMap.size} categories (standard is 5)` });
                } else if (categoryMap.size > 5) {
                    warnings.push({ type: 'warning', message: `${roundLabel} has ${categoryMap.size} categories (only first 5 will be used)` });
                }
            }

            // Check for Final Jeopardy
            if (!hasFinalJeopardy) {
                warnings.push({ type: 'warning', message: 'No Final Jeopardy question found' });
            }

            const isValid = errors.length === 0;
            return { warnings, errors, isValid, format, hasRound2 };
        }

        // Warning Modal
        function showWarningModal(warnings, errors, onProceed) {
            warningItems.innerHTML = '';
            
            errors.forEach(item => {
                const li = document.createElement('li');
                li.className = 'error';
                li.textContent = item.message;
                warningItems.appendChild(li);
            });
            
            warnings.forEach(item => {
                const li = document.createElement('li');
                li.className = item.type === 'info' ? 'info' : '';
                li.textContent = item.message;
                warningItems.appendChild(li);
            });

            proceedBtn.onclick = () => {
                closeWarningModal();
                onProceed();
            };

            // Disable proceed if there are critical errors
            if (errors.length > 0) {
                proceedBtn.style.display = 'none';
            } else {
                proceedBtn.style.display = 'block';
            }

            warningModal.classList.add('active');
        }

        function closeWarningModal() {
            warningModal.classList.remove('active');
        }

        // Parse CSV (handles both formats)
        function parseCSV(text) {
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            const format = detectCSVFormat(lines);
            const isTwoRound = format === 'two-round';
            
            const roundCategories = { 1: new Map(), 2: new Map() };
            let finalJeopardy = { category: 'Final Jeopardy', prompt: '', answer: '' };

            // Skip header row
            for (let i = 1; i < lines.length; i++) {
                const parts = parseCSVLine(lines[i]);
                
                let round, category, order, prompt, answer;
                
                if (isTwoRound) {
                    if (parts.length < 5) continue;
                    [round, category, order, prompt, answer] = parts;
                    
                    const roundLower = round.toLowerCase().trim();
                    if (roundLower === 'final') {
                        round = 'final';
                    } else {
                        round = parseInt(round) || 1;
                    }
                } else {
                    if (parts.length < 4) continue;
                    [category, order, prompt, answer] = parts;
                    round = 1;
                }

                if (!category || !prompt) continue;

                // Check for Final Jeopardy
                if (order.toLowerCase() === 'final' || round === 'final') {
                    finalJeopardy = {
                        category: category,
                        prompt: prompt,
                        answer: answer || ''
                    };
                    continue;
                }

                // Regular question - normalize order
                const normalizedOrder = normalizeOrder(order);
                if (normalizedOrder === null) continue;

                const roundNum = round || 1;
                if (!roundCategories[roundNum]) roundCategories[roundNum] = new Map();
                
                if (!roundCategories[roundNum].has(category)) {
                    roundCategories[roundNum].set(category, {
                        name: category,
                        promptsByOrder: new Map()
                    });
                }

                roundCategories[roundNum].get(category).promptsByOrder.set(normalizedOrder, {
                    prompt: prompt,
                    answer: answer || ''
                });
            }

            // Convert to array format
            const standardOrders = [1, 2, 3, 4];
            const result = {
                rounds: { 1: [], 2: [] },
                finalJeopardy,
                hasTwoRounds: roundCategories[2] && roundCategories[2].size > 0
            };

            for (const [roundNum, categoryMap] of Object.entries(roundCategories)) {
                const categories = [];
                for (const [catName, catData] of categoryMap) {
                    const prompts = [];
                    for (const ord of standardOrders) {
                        const questionData = catData.promptsByOrder.get(ord);
                        if (questionData) {
                            prompts.push({
                                prompt: questionData.prompt,
                                answer: questionData.answer,
                                order: ord
                            });
                        }
                    }
                    if (prompts.length > 0) {
                        categories.push({
                            name: catName,
                            prompts: prompts
                        });
                    }
                }
                result.rounds[roundNum] = categories;
            }

            return result;
        }

        // Handle file with encoding detection
        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                let text = event.target.result;
                
                if (text.includes('\uFFFD')) {
                    const reader2 = new FileReader();
                    reader2.onload = (event2) => {
                        processCSVWithValidation(event2.target.result);
                    };
                    reader2.readAsText(file, 'windows-1252');
                } else {
                    processCSVWithValidation(text);
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        // Process CSV with validation
        function processCSVWithValidation(text) {
            const validation = validateCSV(text);
            
            if (!validation.isValid || validation.warnings.length > 0 || validation.errors.length > 0) {
                showWarningModal(validation.warnings, validation.errors, () => {
                    processCSV(text);
                });
            } else {
                processCSV(text);
            }
        }

        // Get configured point values
        function getPointValues() {
            return pointValueInputs.map(input => parseInt(input.value) || 0);
        }

        // Process CSV content
        function processCSV(text) {
            const parsed = parseCSV(text);

            // Get settings
            timerEnabled = timerEnabledCheckbox.checked;
            if (timerPreset.value === 'custom') {
                timerDuration = parseInt(timerCustom.value) || 60;
            } else {
                timerDuration = parseInt(timerPreset.value);
            }
            
            pointValues = getPointValues();

            // Setup game data
            gameData.rounds = {
                1: {
                    categories: parsed.rounds[1],
                    dailyDoubleCells: [],
                    usedCells: new Set(),
                    totalCells: Math.min(
                        parsed.rounds[1].length * 4,
                        parsed.rounds[1].reduce((sum, cat) => sum + cat.prompts.length, 0)
                    )
                },
                2: {
                    categories: parsed.rounds[2],
                    dailyDoubleCells: [],
                    usedCells: new Set(),
                    totalCells: Math.min(
                        parsed.rounds[2].length * 4,
                        parsed.rounds[2].reduce((sum, cat) => sum + cat.prompts.length, 0)
                    )
                }
            };
            gameData.finalJeopardy = parsed.finalJeopardy;
            gameData.currentRound = 1;
            gameData.hasTwoRounds = parsed.hasTwoRounds;

            // Setup Daily Doubles
            // Round 1: 1 Daily Double
            // Round 2: 2 Daily Doubles (if two-round game)
            setupDailyDoubles(1, 1);
            if (gameData.hasTwoRounds) {
                setupDailyDoubles(2, 2);
            }

            buildBoard();
            updateModeIndicator();
            showScreen('board');
        }

        // Setup Daily Doubles for a round
        function setupDailyDoubles(roundNum, count) {
            const round = gameData.rounds[roundNum];
            const numCategories = Math.min(round.categories.length, 5);
            
            if (numCategories === 0) return;
            
            const usedPositions = new Set();
            
            for (let dd = 0; dd < count; dd++) {
                let attempts = 0;
                let cellId;
                
                do {
                    const randomCol = Math.floor(Math.random() * numCategories);
                    const numPromptsInCategory = round.categories[randomCol]?.prompts.length || 4;
                    const randomRow = Math.floor(Math.random() * Math.min(numPromptsInCategory, 4));
                    cellId = `${randomCol}-${randomRow}`;
                    attempts++;
                } while (usedPositions.has(cellId) && attempts < 50);
                
                if (!usedPositions.has(cellId)) {
                    usedPositions.add(cellId);
                    round.dailyDoubleCells.push(cellId);
                }
            }
        }

        // Update mode indicator
        function updateModeIndicator() {
            if (gameData.hasTwoRounds) {
                const roundName = gameData.currentRound === 1 ? 'JEOPARDY!' : 'DOUBLE JEOPARDY!';
                modeIndicator.textContent = roundName;
                modeIndicator.classList.remove('hidden');
            } else {
                modeIndicator.classList.add('hidden');
            }
        }

        // Get display value for a row (0-indexed)
        function getDisplayValue(rowIndex) {
            const baseValue = pointValues[rowIndex] || 0;
            return gameData.currentRound === 2 ? baseValue * 2 : baseValue;
        }

        // Get current round data
        function getCurrentRound() {
            return gameData.rounds[gameData.currentRound];
        }

        // Build game board
        function buildBoard() {
            boardGrid.innerHTML = '';
            const round = getCurrentRound();

            // Category row
            for (let col = 0; col < 5; col++) {
                const cell = document.createElement('div');
                cell.className = 'cell category-cell';
                cell.textContent = round.categories[col]?.name || `Category ${col + 1}`;
                boardGrid.appendChild(cell);
            }

            // Value rows (4 rows for orders 1-4)
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 5; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell value-cell';
                    const displayValue = getDisplayValue(row);
                    cell.textContent = `$${displayValue}`;
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.dataset.displayValue = displayValue;

                    const cellId = `${col}-${row}`;
                    if (round.usedCells.has(cellId)) {
                        cell.classList.add('used');
                    } else {
                        cell.addEventListener('click', () => selectCell(col, row));
                    }

                    boardGrid.appendChild(cell);
                }
            }
        }

        // Timer functions
        let activeTimerDisplay = null;

        function startTimer(useFinalDisplay = false) {
            if (!timerEnabled) {
                timerDisplay.style.display = 'none';
                finalTimerDisplay.style.display = 'none';
                return;
            }

            activeTimerDisplay = useFinalDisplay ? finalTimerDisplay : timerDisplay;
            
            // Hide the other display
            if (useFinalDisplay) {
                timerDisplay.style.display = 'none';
            } else {
                finalTimerDisplay.style.display = 'none';
            }

            activeTimerDisplay.style.display = 'block';
            timerSeconds = timerDuration;
            updateTimerDisplay();

            timerInterval = setInterval(() => {
                timerSeconds--;
                updateTimerDisplay();

                if (timerSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            timerDisplay.style.display = 'none';
            timerDisplay.classList.remove('warning', 'critical');
            finalTimerDisplay.style.display = 'none';
            finalTimerDisplay.classList.remove('warning', 'critical');
            activeTimerDisplay = null;
        }

        function updateTimerDisplay() {
            if (!activeTimerDisplay) return;
            
            activeTimerDisplay.textContent = timerSeconds;
            
            activeTimerDisplay.classList.remove('warning', 'critical');
            if (timerSeconds <= 5) {
                activeTimerDisplay.classList.add('critical');
            } else if (timerSeconds <= 10) {
                activeTimerDisplay.classList.add('warning');
            }
        }

        // Select a cell
        function selectCell(col, row) {
            const round = getCurrentRound();
            const cellId = `${col}-${row}`;
            if (round.usedCells.has(cellId)) return;

            const displayValue = getDisplayValue(row);
            currentCell = { col, row, displayValue, id: cellId };
            const promptData = round.categories[col]?.prompts[row];

            if (promptData) {
                promptValue.textContent = `$${displayValue}`;
                promptText.textContent = promptData.prompt;
                
                // Check if this is a Daily Double
                if (round.dailyDoubleCells.includes(cellId)) {
                    showScreen('daily-double');
                } else {
                    showScreen('prompt');
                    startTimer();
                }
            }
        }

        // Check if round is complete
        function isRoundComplete() {
            const round = getCurrentRound();
            return round.usedCells.size >= round.totalCells;
        }

        // Advance to next round or final
        function advanceGame() {
            if (gameData.currentRound === 1 && gameData.hasTwoRounds) {
                // Go to round 2
                showScreen('round-transition');
            } else {
                // Go to Final Jeopardy
                showScreen('final-title');
            }
        }

        // Show screen
        function showScreen(screen) {
            currentView = screen;

            uploadScreen.style.display = 'none';
            gameBoard.style.display = 'none';
            dailyDoubleScreen.classList.remove('active');
            roundTransitionScreen.classList.remove('active');
            promptScreen.classList.remove('active');
            finalScreen.classList.remove('active');
            gameOver.classList.remove('active');

            switch (screen) {
                case 'upload':
                    uploadScreen.style.display = 'flex';
                    resetBtn.classList.add('hidden');
                    modeIndicator.classList.add('hidden');
                    break;
                case 'board':
                    gameBoard.style.display = 'block';
                    resetBtn.classList.remove('hidden');
                    updateModeIndicator();
                    break;
                case 'daily-double':
                    dailyDoubleScreen.classList.add('active');
                    break;
                case 'round-transition':
                    roundTransitionScreen.classList.add('active');
                    break;
                case 'prompt':
                    promptScreen.classList.add('active');
                    break;
                case 'answer':
                    promptScreen.classList.add('active');
                    break;
                case 'final-title':
                    finalTitle.style.display = 'block';
                    finalCategory.style.display = 'block';
                    finalCategory.textContent = gameData.finalJeopardy.category;
                    finalText.style.display = 'none';
                    finalTimerDisplay.style.display = 'none';
                    modeIndicator.classList.add('hidden');
                    finalScreen.classList.add('active');
                    break;
                case 'final-prompt':
                    finalTitle.style.display = 'none';
                    finalCategory.style.display = 'none';
                    finalText.style.display = 'block';
                    finalText.textContent = gameData.finalJeopardy.prompt;
                    finalScreen.classList.add('active');
                    startTimer(true);
                    break;
                case 'final-answer':
                    stopTimer();
                    finalTitle.style.display = 'none';
                    finalCategory.style.display = 'none';
                    finalText.style.display = 'block';
                    finalText.textContent = gameData.finalJeopardy.answer;
                    finalScreen.classList.add('active');
                    break;
                case 'game-over':
                    gameOver.classList.add('active');
                    break;
            }
        }

        // Click handlers
        dailyDoubleScreen.addEventListener('click', () => {
            if (currentView === 'daily-double') {
                showScreen('prompt');
                startTimer();
            }
        });

        roundTransitionScreen.addEventListener('click', () => {
            if (currentView === 'round-transition') {
                gameData.currentRound = 2;
                buildBoard();
                showScreen('board');
            }
        });

        promptScreen.addEventListener('click', () => {
            if (currentView === 'prompt') {
                stopTimer();
                const round = getCurrentRound();
                const promptData = round.categories[currentCell.col]?.prompts[currentCell.row];
                if (promptData) {
                    promptText.textContent = promptData.answer;
                    currentView = 'answer';
                }
            } else if (currentView === 'answer') {
                const round = getCurrentRound();
                round.usedCells.add(currentCell.id);
                buildBoard();

                if (isRoundComplete()) {
                    advanceGame();
                } else {
                    showScreen('board');
                }
            }
        });

        finalScreen.addEventListener('click', () => {
            if (currentView === 'final-title') {
                showScreen('final-prompt');
            } else if (currentView === 'final-prompt') {
                showScreen('final-answer');
            } else if (currentView === 'final-answer') {
                showScreen('game-over');
            }
        });

        // File input handler
        csvInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        });

        // Reset game
        function resetGame() {
            stopTimer();
            gameData = {
                rounds: {
                    1: { categories: [], dailyDoubleCells: [], usedCells: new Set(), totalCells: 0 },
                    2: { categories: [], dailyDoubleCells: [], usedCells: new Set(), totalCells: 0 }
                },
                finalJeopardy: { category: '', prompt: '', answer: '' },
                currentRound: 1,
                hasTwoRounds: false
            };
            currentCell = null;
            csvInput.value = '';
            showScreen('upload');
        }

        // Initialize
        showScreen('upload');
    </script>
</body>
</html>
